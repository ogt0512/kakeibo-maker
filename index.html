<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶è¨ˆç°¿æ­£æ–¹å½¢ãƒ¡ãƒ¼ã‚«ãƒ¼</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --main-bg: #fdf5e6; --accent: #d2b48c; }
        body { font-family: sans-serif; background: #eee; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        
        .container { display: flex; flex-direction: row; gap: 20px; max-width: 1200px; width: 100%; padding: 20px; box-sizing: border-box; justify-content: center; }

        @media (max-width: 900px) {
            .container { flex-direction: column; align-items: center; padding: 10px; }
            .preview-area { order: -1; position: static !important; width: 100% !important; display: flex; flex-direction: column; align-items: center; }
            #capture-target { width: 95vw !important; height: 95vw !important; max-width: 500px; max-height: 500px; }
            .editor { width: 100%; height: auto !important; }
        }
        
        .editor { flex: 1; background: white; padding: 20px; border-radius: 10px; height: 95vh; overflow-y: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .input-section { margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; }
        .input-section h4 { margin: 10px 0; font-size: 16px; color: var(--accent); display: flex; justify-content: space-between; align-items: center; }
        
        .input-group { display: flex; align-items: center; margin-bottom: 8px; gap: 5px; }
        .label-edit { width: 110px; font-size: 14px; border: 1px dashed #ccc; padding: 5px; }
        input[type="number"] { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }

        .add-btn { font-size: 11px; padding: 4px 8px; background: var(--accent); color: white; border: none; border-radius: 4px; cursor: pointer; }
        .del-btn { color: #ccc; cursor: pointer; border: none; background: none; font-size: 18px; padding: 0 5px; }

        /* ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ */
        .preview-area { flex: 0 0 500px; position: sticky; top: 10px; }
        #capture-target {
            width: 500px; height: 500px;
            background: var(--main-bg); padding: 0 25px 15px 25px;
            border: 10px solid var(--accent); color: #333;
            display: flex; flex-direction: column; box-sizing: border-box; position: relative;
        }
        
        .header-container { display: flex; justify-content: center; margin-top: -1px; }
        .header { background-color: var(--accent); color: white; padding: 5px 40px; border-radius: 0 0 50px 50px; font-size: 18px; font-weight: bold; display: inline-block; line-height: 1; }
        
        /* é …ç›®æ•°ã«åˆã‚ã›ã¦JavaScriptã§ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å¯å¤‰ã«ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯åŸºæœ¬è¨­å®šã®ã¿ */
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 0 15px; flex-grow: 1; align-content: space-evenly; overflow: hidden; }
        .section-title { font-weight: bold; margin: 4px 0 2px 0; color: #444; border-bottom: 1px solid var(--accent); }
        .item { display: flex; border-bottom: 1px dotted #ccc; margin-bottom: 1px; align-items: baseline; }
        .item-label { flex: 1; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .item-value { width: 65px; text-align: right; font-weight: bold; }
        .unit { width: 15px; text-align: right; margin-left: 2px; }

        .total-box { text-align: right; font-weight: bold; border-top: 1px solid var(--accent); margin-top: 1px; }
        .highlight { background-color: rgba(210, 180, 140, 0.2); }

        .save-btn { margin: 15px 0; padding: 15px; background: #ff9800; color: white; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; width: 100%; font-weight: bold; }

        /* å¾…æ©Ÿç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #ad-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); color: white; z-index: 9999;
            flex-direction: column; align-items: center; justify-content: center; text-align: center;
        }
        .ad-modal { background: white; padding: 20px; border-radius: 15px; color: #333; max-width: 90%; }
        #download-link { display: none; margin-top: 20px; padding: 15px 30px; background: #4CAF50; color: white; text-decoration: none; border-radius: 50px; font-weight: bold; }
    </style>
</head>
<body>

<div id="ad-overlay">
    <div class="ad-modal">
        <h3 id="wait-message">ç”»åƒã‚’ç”Ÿæˆä¸­ã§ã™... (10)</h3>
        <p style="font-size: 12px; color: #666;">å¾…ã¡æ™‚é–“ã«å®¶è¨ˆã®è¦‹ç›´ã—ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿ</p>
        <div style="margin: 20px 0; min-height: 100px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center;">
             <p>ã“ã“ã«åºƒå‘ŠãƒãƒŠãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
        </div>
        <a id="download-link" href="#" onclick="closeOverlay()">ğŸ’¾ ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</a>
        <p id="wait-note" style="font-size: 11px; margin-top: 10px;">â€»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³çµ‚äº†å¾Œã«ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
    </div>
</div>

<div class="container">
    <div class="preview-area">
        <div id="capture-target">
            <div class="header-container"><div class="header">å®¶è¨ˆç°¿Check!</div></div>
            <div class="main-content">
                <div id="preview-left"></div>
                <div id="preview-right"></div>
            </div>
        </div>
        <button class="save-btn" onclick="startProcess()">ç”»åƒã‚’ä¿å­˜ã™ã‚‹</button>
    </div>
    <div class="editor" id="form-container">
        <h3>å®¶è¨ˆç°¿ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h3>
        <div id="dynamic-inputs"></div>
    </div>
</div>

<script>
    const sections = [
        { side: 'left', title: "â—æœˆé–“åå…¥", prefix: "in", items: ["ãƒ‘ãƒ‘", "ãƒãƒ", "å…ç«¥æ‰‹å½“"], hasTotal: true },
        { side: 'left', title: "â—æœˆé–“æ”¯å‡º", prefix: "ex", items: ["ä½å±…è²»", "æ•™è‚²è²»", "ä¿é™ºæ–™", "æ°´é“ãƒ»å…‰ç†±è²»", "é€šä¿¡è²»", "è»Šè²»", "ãƒ‘ãƒ‘ãŠå°é£ã„", "ãƒãƒãŠå°é£ã„", "é£Ÿè²»", "æ—¥ç”¨å“è²»", "ãƒ¬ã‚¸ãƒ£ãƒ¼è²»", "ãã®ä»–"], hasTotal: true, highlight: true },
        { side: 'left', title: "â—æœˆé–“è²¯è“„", prefix: "sv", items: ["æ™®é€šè²¯è“„", "NISA", "ç©ç«‹ä¿é™º", "ç¢ºå®šæ‹ å‡ºå¹´é‡‘"], hasTotal: false },
        { side: 'right', title: "â—ãƒœãƒ¼ãƒŠã‚¹(å¹´é–“)", prefix: "bn", items: ["ãƒ‘ãƒ‘", "ãƒãƒ"], hasTotal: true },
        { side: 'right', title: "â—å¹´å˜ä½ã®æ”¯å‡º", prefix: "yr", items: ["æ—…è¡Œãƒ»å¸°çœãªã©", "å›ºå®šè³‡ç”£ç¨", "ä¿é™ºæ–™", "è»Šæ¤œä»£"], hasTotal: true, highlight: true },
        { side: 'right', title: "â—ç¾åœ¨ã®ç·è³‡ç”£", prefix: "as", items: ["æ™®é€šè²¯è“„", "NISA", "å¤–è²¨ä¿é™º(ä¸€æ‹¬)", "å¤–è²¨ä¿é™º(ç©ç«‹)", "ã‚¸ãƒ¥ãƒ‹ã‚¢NISA", "ç¢ºå®šæ‹ å‡ºå¹´é‡‘"], hasTotal: false }
    ];

    function init() {
        const container = document.getElementById('dynamic-inputs');
        sections.forEach((sec) => {
            const secDiv = document.createElement('div');
            secDiv.className = 'input-section';
            secDiv.innerHTML = `<h4>${sec.title} <button class="add-btn" onclick="addItem('${sec.prefix}')">ï¼‹è¿½åŠ </button></h4>
                                <div id="items-${sec.prefix}"></div>`;
            container.appendChild(secDiv);
            sec.items.forEach(label => addItem(sec.prefix, label, 0));
        });
    }

    function addItem(prefix, label = "æ–°é …ç›®", value = "") {
        const itemContainer = document.getElementById(`items-${prefix}`);
        const group = document.createElement('div');
        group.className = 'input-group';
        group.innerHTML = `<button class="del-btn" onclick="this.parentElement.remove(); update();">Ã—</button>
            <input type="text" class="label-edit" value="${label}" oninput="update()">
            <input type="number" value="${value}" placeholder="0" oninput="update()">`;
        itemContainer.appendChild(group);
        update();
    }

    function update() {
        let totalItemsCount = 0;
        const allGroups = document.querySelectorAll('.input-group');
        allGroups.forEach(g => { if(g.querySelector('input[type="number"]').value !== "") totalItemsCount++; });

        // âœ¨ é …ç›®æ•°ã«å¿œã˜ã¦æ–‡å­—ã‚µã‚¤ã‚ºã‚’å‹•çš„ã«æ±ºå®šï¼ˆ12pxã€œ8pxã®é–“ã§è‡ªå‹•èª¿æ•´ï¼‰
        let fontSize = 11;
        if (totalItemsCount > 30) fontSize = 8.5;
        else if (totalItemsCount > 25) fontSize = 9.5;
        else if (totalItemsCount > 20) fontSize = 10.5;

        // PCãƒ–ãƒ©ã‚¦ã‚¶åˆ¤å®šï¼ˆã‚¹ãƒãƒ›ã§ãªã„å ´åˆã¯å°‘ã—å¤§ããã™ã‚‹ï¼‰
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        if(!isMobile) fontSize += 1; 

        ['left', 'right'].forEach(side => {
            const previewContainer = document.getElementById(`preview-${side}`);
            previewContainer.innerHTML = '';
            sections.filter(s => s.side === side).forEach(sec => {
                const itemDivs = document.querySelectorAll(`#items-${sec.prefix} .input-group`);
                let sectionHtml = `<div class="section-title" style="font-size: ${fontSize + 1}px;">${sec.title}</div>`;
                let sum = 0, count = 0;
                itemDivs.forEach(div => {
                    const label = div.querySelector('input[type="text"]').value;
                    const valStr = div.querySelector('input[type="number"]').value;
                    if (valStr !== "") {
                        const val = Number(valStr) || 0;
                        sum += val; count++;
                        sectionHtml += `<div class="item" style="font-size: ${fontSize}px;">
                            <span class="item-label">${label}</span>
                            <span class="item-value">${val.toLocaleString()}</span>
                            <span class="unit">å††</span></div>`;
                    }
                });
                if (count > 0) {
                    if(sec.hasTotal) sectionHtml += `<div class="total-box ${sec.highlight ? 'highlight' : ''}" style="font-size: ${fontSize}px;">åˆè¨ˆ ${sum.toLocaleString()} å††</div>`;
                    const div = document.createElement('div'); div.style.marginBottom = "8px"; div.innerHTML = sectionHtml;
                    previewContainer.appendChild(div);
                }
            });
        });
    }

    function startProcess() {
        const overlay = document.getElementById('ad-overlay');
        overlay.style.display = 'flex';
        let timeLeft = 10;
        html2canvas(document.getElementById('capture-target'), { scale: 3 }).then(canvas => {
            const link = document.getElementById('download-link');
            link.href = canvas.toDataURL("image/png");
            link.download = 'kakeibo_check.png';
        });
        const timer = setInterval(() => {
            timeLeft--;
            document.getElementById('wait-message').innerText = `ç”»åƒã‚’ç”Ÿæˆä¸­ã§ã™... (${timeLeft})`;
            if (timeLeft <= 0) {
                clearInterval(timer);
                document.getElementById('wait-message').innerText = "ç”Ÿæˆå®Œäº†ï¼";
                document.getElementById('download-link').style.display = 'inline-block';
                document.getElementById('wait-note').style.display = 'none';
            }
        }, 1000);
    }

    function closeOverlay() { document.getElementById('ad-overlay').style.display = 'none'; }
    window.onload = init;
</script>
</body>
</html>